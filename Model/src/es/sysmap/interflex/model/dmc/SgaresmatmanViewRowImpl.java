package es.sysmap.interflex.model.dmc;
import es.sysmap.interflex.model.bdc.Sgamovexist;
import oracle.jbo.RowIterator;
import oracle.jbo.ViewObject;
import oracle.jbo.server.ViewRowImpl;
import oracle.jbo.server.AttributeDefImpl;
import oracle.jbo.domain.Number;

import org.apache.log4j.Logger;

//  ---------------------------------------------------------------------
//  ---    File generated by Oracle ADF Business Components Design Time.
//  ---    Custom code may be added to this class.
//  ---    Warning: Do not modify method signatures of generatedc methods.
//  ---------------------------------------------------------------------

public class SgaresmatmanViewRowImpl extends ViewRowImpl implements es.sysmap.interflex.model.dmc.common.SgaresmatmanViewRow 
{
 
  private Logger LOG = Logger.getLogger(getClass());
 
  public static final int IDDOC = 0;
  public static final int IDLIN = 1;
  public static final int IDMAC = 2;
  public static final int IDART = 3;
  public static final int IDBULTOPK = 4;
  public static final int CANRES = 5;
  public static final int IDBULTO = 6;
  public static final int IDARTIF = 7;
  public static final int DESCRIP = 8;
  public static final int IDUBI = 9;
  public static final int PASILLO = 10;
  public static final int COLUMNA = 11;
  public static final int NIVEL = 12;
  public static final int IDCABSTR = 13;
  public static final int IDCABNUM = 14;
  public static final int IDTIPDOC = 15;
  public static final int INTEGRA = 16;
  public static final int UNIEMB = 17;
  public static final int BULTOSLO = 18;
  public static final int BULTOMLD = 19;
  public static final int TALBARAN = 20;
  public static final int NALBARAN = 21;
  public static final int BULTOMAN = 22;
  public static final int CANCON = 23;
  public static final int SGABULTOVIEW1 = 24;
  /**
   * 
   *  This is the default constructor (do not remove)
   */
  public SgaresmatmanViewRowImpl()
  {
  }

  /**
   * 
   *  Gets Sgaresmat entity object.
   */
  public es.sysmap.interflex.model.bdc.SgaresmatImpl getSgaresmat()
  {
    return (es.sysmap.interflex.model.bdc.SgaresmatImpl)getEntity(0);
  }

  /**
   * 
   *  Gets the attribute value for IDDOC using the alias name Iddoc
   */
  public Number getIddoc()
  {
    return (Number)getAttributeInternal(IDDOC);
  }

  /**
   * 
   *  Sets <code>value</code> as attribute value for IDDOC using the alias name Iddoc
   */
  public void setIddoc(Number value)
  {
    setAttributeInternal(IDDOC, value);
  }

  /**
   * 
   *  Gets the attribute value for IDLIN using the alias name Idlin
   */
  public Number getIdlin()
  {
    return (Number)getAttributeInternal(IDLIN);
  }

  /**
   * 
   *  Sets <code>value</code> as attribute value for IDLIN using the alias name Idlin
   */
  public void setIdlin(Number value)
  {
    setAttributeInternal(IDLIN, value);
  }

  /**
   * 
   *  Gets the attribute value for IDMAC using the alias name Idmac
   */
  public String getIdmac()
  {
    return (String)getAttributeInternal(IDMAC);
  }

  /**
   * 
   *  Sets <code>value</code> as attribute value for IDMAC using the alias name Idmac
   */
  public void setIdmac(String value)
  {
    setAttributeInternal(IDMAC, value);
  }

  /**
   * 
   *  Gets the attribute value for IDART using the alias name Idart
   */
  public String getIdart()
  {
    return (String)getAttributeInternal(IDART);
  }

  /**
   * 
   *  Sets <code>value</code> as attribute value for IDART using the alias name Idart
   */
  public void setIdart(String value)
  {
    setAttributeInternal(IDART, value);
  }

  /**
   * 
   *  Gets the attribute value for IDBULTOPK using the alias name Idbultopk
   */
  public Number getIdbultopk()
  {
    return (Number)getAttributeInternal(IDBULTOPK);
  }

  /**
   * 
   *  Sets <code>value</code> as attribute value for IDBULTOPK using the alias name Idbultopk
   */
  public void setIdbultopk(Number value)
  {
    setAttributeInternal(IDBULTOPK, value);
  }

  /**
   * 
   *  Gets the attribute value for CANRES using the alias name Canres
   */
  public Number getCanres()
  {
    return (Number)getAttributeInternal(CANRES);
  }

  /**
   * 
   *  Sets <code>value</code> as attribute value for CANRES using the alias name Canres
   */
  public void setCanres(Number value)
  {
    setAttributeInternal(CANRES, value);
  }

  /**
   * 
   *  Gets the attribute value for IDBULTO using the alias name Idbulto
   */
  public Number getIdbulto()
  {
    return (Number)getAttributeInternal(IDBULTO);
  }

  /**
   * 
   *  Sets <code>value</code> as attribute value for IDBULTO using the alias name Idbulto
   */
  public void setIdbulto(Number value)
  {
    setAttributeInternal(IDBULTO, value);
  }

  /**
   * 
   *  Gets the attribute value for IDARTIF using the alias name Idartif
   */
  public String getIdartif()
  {
    return (String)getAttributeInternal(IDARTIF);
  }

  /**
   * 
   *  Sets <code>value</code> as attribute value for IDARTIF using the alias name Idartif
   */
  public void setIdartif(String value)
  {
    setAttributeInternal(IDARTIF, value);
  }

  /**
   * 
   *  Gets the attribute value for DESCRIP using the alias name Descrip
   */
  public String getDescrip()
  {
    return (String)getAttributeInternal(DESCRIP);
  }

  /**
   * 
   *  Sets <code>value</code> as attribute value for DESCRIP using the alias name Descrip
   */
  public void setDescrip(String value)
  {
    setAttributeInternal(DESCRIP, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Idubi
   */
  public String getIdubi()
  {
    return (String)getAttributeInternal(IDUBI);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Idubi
   */
  public void setIdubi(String value)
  {
    setAttributeInternal(IDUBI, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Pasillo
   */
  public Number getPasillo()
  {
    return (Number)getAttributeInternal(PASILLO);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Pasillo
   */
  public void setPasillo(Number value)
  {
    setAttributeInternal(PASILLO, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Columna
   */
  public Number getColumna()
  {
    return (Number)getAttributeInternal(COLUMNA);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Columna
   */
  public void setColumna(Number value)
  {
    setAttributeInternal(COLUMNA, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Nivel
   */
  public Number getNivel()
  {
    return (Number)getAttributeInternal(NIVEL);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Nivel
   */
  public void setNivel(Number value)
  {
    setAttributeInternal(NIVEL, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Cancon
   */
  public Number getCancon()
  {
    // Fem que per defecte torni la quantitat reservada
    Number cancon = (Number)getAttributeInternal(CANCON);
    if (cancon == null)
      return getCanres();
    else
      return cancon;
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Cancon
   */
  public void setCancon(Number value)
  {
    setAttributeInternal(CANCON, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Idcabstr
   */
  public String getIdcabstr()
  {
    return (String)getAttributeInternal(IDCABSTR);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Idcabstr
   */
  public void setIdcabstr(String value)
  {
    setAttributeInternal(IDCABSTR, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Idcabnum
   */
  public String getIdcabnum()
  {
    return (String)getAttributeInternal(IDCABNUM);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Idcabnum
   */
  public void setIdcabnum(String value)
  {
    setAttributeInternal(IDCABNUM, value);
  }

  /**
   * 
   *  getAttrInvokeAccessor: generated method. Do not modify.
   */
  protected Object getAttrInvokeAccessor(int index, AttributeDefImpl attrDef) throws Exception
  {
    switch (index)
      {
      case IDDOC:
        return getIddoc();
      case IDLIN:
        return getIdlin();
      case IDMAC:
        return getIdmac();
      case IDART:
        return getIdart();
      case IDBULTOPK:
        return getIdbultopk();
      case CANRES:
        return getCanres();
      case IDBULTO:
        return getIdbulto();
      case IDARTIF:
        return getIdartif();
      case DESCRIP:
        return getDescrip();
      case IDUBI:
        return getIdubi();
      case PASILLO:
        return getPasillo();
      case COLUMNA:
        return getColumna();
      case NIVEL:
        return getNivel();
      case IDCABSTR:
        return getIdcabstr();
      case IDCABNUM:
        return getIdcabnum();
      case IDTIPDOC:
        return getIdtipdoc();
      case INTEGRA:
        return getIntegra();
      case UNIEMB:
        return getUniemb();
      case BULTOSLO:
        return getBultoslo();
      case BULTOMLD:
        return getBultomld();
      case TALBARAN:
        return getTalbaran();
      case NALBARAN:
        return getNalbaran();
      case BULTOMAN:
        return getBultoman();
      case CANCON:
        return getCancon();
      case SGABULTOVIEW1:
        return getSgabultoView1();
      default:
        return super.getAttrInvokeAccessor(index, attrDef);
      }
  }

  /**
   * 
   *  setAttrInvokeAccessor: generated method. Do not modify.
   */
  protected void setAttrInvokeAccessor(int index, Object value, AttributeDefImpl attrDef) throws Exception
  {
    switch (index)
      {
      case IDDOC:
        setIddoc((Number)value);
        return;
      case IDLIN:
        setIdlin((Number)value);
        return;
      case IDMAC:
        setIdmac((String)value);
        return;
      case IDART:
        setIdart((String)value);
        return;
      case IDBULTOPK:
        setIdbultopk((Number)value);
        return;
      case CANRES:
        setCanres((Number)value);
        return;
      case IDBULTO:
        setIdbulto((Number)value);
        return;
      case IDARTIF:
        setIdartif((String)value);
        return;
      case DESCRIP:
        setDescrip((String)value);
        return;
      case IDUBI:
        setIdubi((String)value);
        return;
      case PASILLO:
        setPasillo((Number)value);
        return;
      case COLUMNA:
        setColumna((Number)value);
        return;
      case NIVEL:
        setNivel((Number)value);
        return;
      case IDCABSTR:
        setIdcabstr((String)value);
        return;
      case IDCABNUM:
        setIdcabnum((String)value);
        return;
      case IDTIPDOC:
        setIdtipdoc((String)value);
        return;
      case INTEGRA:
        setIntegra((String)value);
        return;
      case UNIEMB:
        setUniemb((Number)value);
        return;
      case BULTOSLO:
        setBultoslo((Number)value);
        return;
      case BULTOMLD:
        setBultomld((Number)value);
        return;
      case TALBARAN:
        setTalbaran((String)value);
        return;
      case NALBARAN:
        setNalbaran((String)value);
        return;
      case BULTOMAN:
        setBultoman((Number)value);
        return;
      case CANCON:
        setCancon((Number)value);
        return;
      default:
        super.setAttrInvokeAccessor(index, value, attrDef);
        return;
      }
  }
  
  /**
   * Confirma el moviment corresponent a la reserva
   */

  public void confirmarReserva()
  {
    // Posem tota la informació a l'estructura que necessitem per crear l'històric
    Sgamovexist movexist = new Sgamovexist();
    movexist.setCancon(getCancon());
    movexist.setCanres(getCanres());
    movexist.setIdart(getIdart());
    movexist.setIdbulto(getIdbulto());
    movexist.setIdcabnum(getIdcabnum());
    movexist.setIdcabstr(getIdcabstr());
    movexist.setIddoc(getIddoc());
    movexist.setIdlin(getIdlin());
    movexist.setIdmac(getIdmac());
    movexist.setIdtipdoc(getIdtipdoc());
    movexist.setObserv(null);
    movexist.setPesfin(null);
    movexist.setPesini(null);
    movexist.setUbipos(null);
    movexist.setIntegra(getIntegra());
    movexist.setTalbaran(getTalbaran());
    movexist.setNalbaran(getNalbaran());
    
    getSgaresmat().confirmarReserva(movexist);
  }



  public void anularReserva(boolean bAnularPendent)
  {
    getSgaresmat().anularReserva(bAnularPendent);
  }


  /**
   * 
   *  Gets the attribute value for the calculated attribute Idtipdoc
   */
  public String getIdtipdoc()
  {
    return (String)getAttributeInternal(IDTIPDOC);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Idtipdoc
   */
  public void setIdtipdoc(String value)
  {
    setAttributeInternal(IDTIPDOC, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Integra
   */
  public String getIntegra()
  {
    return (String)getAttributeInternal(INTEGRA);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Integra
   */
  public void setIntegra(String value)
  {
    setAttributeInternal(INTEGRA, value);
  }
  
  
  /**
   * 
   * @param canbulto Quantitat màxima per bulto
   * @param idBulto Null si encara no ha estat creat
   * @param tipoCarga SLO/MLD
   */
  public void crearBultos_(String tipoCarga, Number canbulto, boolean bFraccionar, boolean tancarBulto)
  {
    Number idbulto = null;
    // Michael 05.05.2006 Number pes = new Number(0);
    // Poner el peso teórico
    Number pes = getSgaresmat().getPesTeoric(getCancon());
    // Michael 05.05.2006 fin
    if (tipoCarga.equals("SLO"))
      idbulto = this.getBultoslo();
    else if (tipoCarga.equals("MLD"))
      idbulto = this.getBultomld();
    else if (tipoCarga.equals("MAN"))
      idbulto = this.getBultoman();

    // Si la quantitat per bulto es 0, vol dir que tot va a parar al mateix bulto  
    if (canbulto.equals(new Number(0)))
      canbulto = getCancon();
      
    Number cantot = getCancon();
    while (cantot.compareTo(0) > 0)
    {
      // Si cal crear el bulto, el creem
      if (idbulto == null)
        idbulto = nouBulto(tipoCarga);
      // Creem la linia de bulto pel bulto
      boolean trobat = false;
      
      RowIterator bultos = getSgabultoView1();
      while (bultos.hasNext() && !trobat)
      {
        SgabultoViewRowImpl bulto = (SgabultoViewRowImpl)bultos.next();
        Number test = bulto.getIdbulto();
        if (bulto.getIdbulto().equals(idbulto))
        {
          Number afegir = null;
          if (cantot.compareTo(canbulto) >= 0)
            afegir = canbulto;
          else
            afegir = cantot;
          // Pes proporcional segons la quantitat  
          Number pesAfegir = (Number)pes.multiply(afegir).divide(getCancon()).round(2);
          
          bulto.afegirABultoSortida(getIdlin(), getIdart(), afegir, pesAfegir, false);
          cantot = cantot.subtract(afegir);
          if (bFraccionar)
            canbulto = cantot;
          // Resetejem idbulto
          idbulto = null;    
          trobat = true;
        }
        // Si s'ha de tancar el bulto, el tanquem
        if (tancarBulto)
        {
          tancarBulto(tipoCarga);
          tancarBulto = !bFraccionar;
        }
      }
    }
  }
  
   /**
   * 
   * @param canbulto Quantitat màxima per bulto
   * @param idBulto Null si encara no ha estat creat
   * @param tipoCarga SLO/MLD
   */
  public void crearBultos_(String tipoCarga, Number[] canbulto, boolean bFraccionar, boolean tancarBulto)
  {
    Number idbulto = null;
    // Michael 05.05.2006 Number pes = new Number(0);
    // Poner el peso teórico
    Number pes = getSgaresmat().getPesTeoric(getCancon());
    // Michael 05.05.2006 fin
    if (tipoCarga.equals("SLO"))
      idbulto = this.getBultoslo();
    else if (tipoCarga.equals("MLD"))
      idbulto = this.getBultomld();
    else if (tipoCarga.equals("MAN"))
      idbulto = this.getBultoman();
      
      
    LOG.debug("crearBultos_ iddoc: " + getIddoc() + " idLin: " + getIdlin() + " canbulto[0]: " + canbulto[0] + " cancon(): " + getCancon());

    // Si la quantitat per bulto es 0, vol dir que tot va a parar al mateix bulto  
    if (canbulto[0].equals(new Number(0)))
      canbulto[0] = getCancon();
  
    // Cancon is transient, and will be the reserved quantity (by the SGA)
    Number cantot = getCancon();
    int iBultoFraccionat = 0;
    while (cantot.compareTo(0) > 0)
    {
      // Si cal crear el bulto, el creem
      if (idbulto == null)
        idbulto = nouBulto(tipoCarga);
      // Creem la linia de bulto pel bulto
      boolean trobat = false;
      
      RowIterator bultos = getSgabultoView1();
      while (bultos.hasNext() && !trobat)
      {
        SgabultoViewRowImpl bulto = (SgabultoViewRowImpl)bultos.next();
        Number test = bulto.getIdbulto();
        if (bulto.getIdbulto().equals(idbulto))
        {
          Number afegir = null;
          if (cantot.compareTo(canbulto[0]) >= 0)
            afegir = canbulto[0];
          else
            afegir = cantot;
          // Pes proporcional segons la quantitat  
          Number pesAfegir = (Number)pes.multiply(afegir).divide(getCancon()).round(2);
          
          LOG.debug("crearBultos_ afegint: " + getIddoc() + " idLin: " + getIdlin() 
            + " canbulto[0]: " + canbulto[0] + " afegir: " + afegir + " cantot: " + cantot);

          
          bulto.afegirABultoSortida(getIdlin(), getIdart(), afegir, pesAfegir, false);
          cantot = cantot.subtract(afegir);
          iBultoFraccionat++;
          if (bFraccionar)
          {
              if (iBultoFraccionat < canbulto.length)            
              canbulto[0] = canbulto[iBultoFraccionat];
            else
              canbulto[0] = cantot;
          }
          // Resetejem idbulto
          idbulto = null;    
          trobat = true;
        }
        // Si s'ha de tancar el bulto, el tanquem
        if (tancarBulto)
        {
          tancarBulto(tipoCarga);
          tancarBulto = !bFraccionar;
        }
      }
    }
    // Michael TODO 2020 Should throw an exception here if the quantity added is more than the quantity reserved
    
  }
  
  

  /**
   * Crea un bulto nou per una reserva de sortida
   * @return 
   */
  public Number nouBulto(String tipoCarga)
  {
    
    // Creem un bulto pel document
    SgabultoViewRowImpl bulto = (SgabultoViewRowImpl)getSgabultoView1().createRow();
    getSgabultoView1().insertRow(bulto);
    //Xavi, 19/10/05: Afegit per que en cas de que sigui un bulto manual, tingui la marca
    //d'imprimir sempre
    // Michael 22.11.2010 Dejar añadir mas cosas al bulto manual
    // if (tipoCarga.equals("MAN"))
    //  bulto.setImprimir("S");
    //Fi xavi, 19/10/05
    // Michael 22.11.2010 fin
    
    // Actualitzem el numero de bulto al document de sortida
    getSgaresmat().setBultoSalida(tipoCarga, bulto.getIdbulto());
    getApplicationModule().getTransaction().postChanges();
//    ViewObject vo = getApplicationModule().findViewObject("SgavbultoDispSortidaView1");
//    vo.clearCache();
//    vo.executeQuery();
    //Number cancon = getCancon();
    getViewObject().executeQuery();
    //setCancon(cancon);
    //this.populateAttributeAsChanged(CANCON, cancon);
    
    return bulto.getIdbulto();
  }


  /**
   * Tanca el bulto actual assignat a la sortida
   * @return 
   */
  public void tancarBulto(String tipoCarga)
  {
    // Actualitzem el numero de bulto al document de sortida
    getSgaresmat().setBultoSalida(tipoCarga, null);
    getApplicationModule().getTransaction().postChanges();
    //Number cancon = getCancon();
    getViewObject().executeQuery();
    // Michael TODO 27.06.2019 is the above wise???
  }

  /**
   * 
   *  Gets the associated <code>RowIterator</code> using master-detail link SgabultoView1
   */
  public RowIterator getSgabultoView1()
  {
    return (RowIterator)getAttributeInternal(SGABULTOVIEW1);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Uniemb
   */
  public Number getUniemb()
  {
    return (Number)getAttributeInternal(UNIEMB);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Uniemb
   */
  public void setUniemb(Number value)
  {
    setAttributeInternal(UNIEMB, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Bultoslo
   */
  public Number getBultoslo()
  {
    return (Number)getAttributeInternal(BULTOSLO);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Bultoslo
   */
  public void setBultoslo(Number value)
  {
    setAttributeInternal(BULTOSLO, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Bultomld
   */
  public Number getBultomld()
  {
    return (Number)getAttributeInternal(BULTOMLD);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Bultomld
   */
  public void setBultomld(Number value)
  {
    setAttributeInternal(BULTOMLD, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Talbaran
   */
  public String getTalbaran()
  {
    return (String)getAttributeInternal(TALBARAN);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Talbaran
   */
  public void setTalbaran(String value)
  {
    setAttributeInternal(TALBARAN, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Nalbaran
   */
  public String getNalbaran()
  {
    return (String)getAttributeInternal(NALBARAN);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Nalbaran
   */
  public void setNalbaran(String value)
  {
    setAttributeInternal(NALBARAN, value);
  }

  /**
   * 
   *  Gets the attribute value for the calculated attribute Bultoman
   */
  public Number getBultoman()
  {
    return (Number)getAttributeInternal(BULTOMAN);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for the calculated attribute Bultoman
   */
  public void setBultoman(Number value)
  {
    setAttributeInternal(BULTOMAN, value);
  }  
}