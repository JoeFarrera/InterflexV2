package es.sysmap.interflex.model.bdc;
import es.sysmap.xml.XMLTelegrama;
import java.util.Vector;
import oracle.jbo.JboException;
import oracle.jbo.server.EntityImpl;
import oracle.jbo.server.EntityDefImpl;
import oracle.jbo.server.AttributeDefImpl;
import oracle.jbo.domain.Number;
import oracle.jbo.Key;
import oracle.jbo.RowIterator;
import oracle.jbo.domain.Date;
import es.sysmap.interflex.model.bdc.common.FlexiDate;
import oracle.xml.parser.v2.XMLNode;
import org.apache.log4j.Logger;
import org.w3c.dom.Node;
//  ---------------------------------------------------------------------
//  ---    File generated by Oracle ADF Business Components Design Time.
//  ---    Custom code may be added to this class.
//  ---    Warning: Do not modify method signatures of generated methods.
//  ---------------------------------------------------------------------

public class SgaposicionubicacionImpl extends EntityImpl 
{
  public static final int POSICION = 0;
  public static final int ESTADO = 1;
  public static final int IDUBI = 2;
  public static final int ACCESO = 3;
  public static final int CREATEDBY = 4;
  public static final int MODIFIEDBY = 5;
  public static final int CREATEDON = 6;
  public static final int MODIFIEDON = 7;
  public static final int SGAUBICACION = 8;
  public static final int SGAMACDES = 9;
  public static final int SGAMACPOS = 10;



  private Logger LOG = Logger.getLogger(getClass());







  private static EntityDefImpl mDefinitionObject;

  /**
   * 
   *  This is the default constructor (do not remove)
   */
  public SgaposicionubicacionImpl()
  {
  }

  /**
   * 
   *  Retrieves the definition object for this instance class.
   */
  public static synchronized EntityDefImpl getDefinitionObject()
  {
    if (mDefinitionObject == null)
    {
      mDefinitionObject = (EntityDefImpl)EntityDefImpl.findDefObject("es.sysmap.interflex.model.bdc.Sgaposicionubicacion");
    }
    return mDefinitionObject;
  }





  

  /**
   * 
   *  Gets the attribute value for Posicion, using the alias name Posicion
   */
  public Number getPosicion()
  {
    return (Number)getAttributeInternal(POSICION);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for Posicion
   */
  public void setPosicion(Number value)
  {
    setAttributeInternal(POSICION, value);
  }

  /**
   * 
   *  Gets the attribute value for Estado, using the alias name Estado
   */
  public String getEstado()
  {
    return (String)getAttributeInternal(ESTADO);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for Estado
   */
  public void setEstado(String value)
  {
    setAttributeInternal(ESTADO, value);
  }

  /**
   * 
   *  Gets the attribute value for Idubi, using the alias name Idubi
   */
  public String getIdubi()
  {
    return (String)getAttributeInternal(IDUBI);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for Idubi
   */
  public void setIdubi(String value)
  {
    setAttributeInternal(IDUBI, value);
  }

  /**
   * 
   *  getAttrInvokeAccessor: generated method. Do not modify.
   */
  protected Object getAttrInvokeAccessor(int index, AttributeDefImpl attrDef) throws Exception
  {
    switch (index)
      {
      case POSICION:
        return getPosicion();
      case ESTADO:
        return getEstado();
      case IDUBI:
        return getIdubi();
      case ACCESO:
        return getAcceso();
      case CREATEDBY:
        return getCreatedby();
      case MODIFIEDBY:
        return getModifiedby();
      case CREATEDON:
        return getCreatedon();
      case MODIFIEDON:
        return getModifiedon();
      case SGAMACDES:
        return getSgamacDes();
      case SGAMACPOS:
        return getSgamacPos();
      case SGAUBICACION:
        return getSgaubicacion();
      default:
        return super.getAttrInvokeAccessor(index, attrDef);
      }
  }

  /**
   * 
   *  setAttrInvokeAccessor: generated method. Do not modify.
   */
  protected void setAttrInvokeAccessor(int index, Object value, AttributeDefImpl attrDef) throws Exception
  {
    switch (index)
      {
      case POSICION:
        setPosicion((Number)value);
        return;
      case ESTADO:
        setEstado((String)value);
        return;
      case IDUBI:
        setIdubi((String)value);
        return;
      case ACCESO:
        setAcceso((String)value);
        return;
      default:
        super.setAttrInvokeAccessor(index, value, attrDef);
        return;
      }
  }






  /**
   * 
   *  Gets the associated entity SgaubicacionImpl
   */
  public SgaubicacionImpl getSgaubicacion()
  {
    return (SgaubicacionImpl)getAttributeInternal(SGAUBICACION);
  }

  /**
   * 
   *  Sets <code>value</code> as the associated entity SgaubicacionImpl
   */
  public void setSgaubicacion(SgaubicacionImpl value)
  {
    setAttributeInternal(SGAUBICACION, value);
  }


  /**
   * 
   *  Gets the attribute value for Acceso, using the alias name Acceso
   */
  public String getAcceso()
  {
    return (String)getAttributeInternal(ACCESO);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for Acceso
   */
  public void setAcceso(String value)
  {
    setAttributeInternal(ACCESO, value);
  }


  /**
   * 
   *  Gets the attribute value for Createdby, using the alias name Createdby
   */
  public String getCreatedby()
  {
    return (String)getAttributeInternal(CREATEDBY);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for Createdby
   */
  public void setCreatedby(String value)
  {
    setAttributeInternal(CREATEDBY, value);
  }

  /**
   * 
   *  Gets the attribute value for Modifiedby, using the alias name Modifiedby
   */
  public String getModifiedby()
  {
    return (String)getAttributeInternal(MODIFIEDBY);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for Modifiedby
   */
  public void setModifiedby(String value)
  {
    setAttributeInternal(MODIFIEDBY, value);
  }

  /**
   * 
   *  Gets the attribute value for Createdon, using the alias name Createdon
   */
  public FlexiDate getCreatedon()
  {
    return (FlexiDate)getAttributeInternal(CREATEDON);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for Createdon
   */
  public void setCreatedon(FlexiDate value)
  {
    setAttributeInternal(CREATEDON, value);
  }

  /**
   * 
   *  Gets the attribute value for Modifiedon, using the alias name Modifiedon
   */
  public FlexiDate getModifiedon()
  {
    return (FlexiDate)getAttributeInternal(MODIFIEDON);
  }

  /**
   * 
   *  Sets <code>value</code> as the attribute value for Modifiedon
   */
  public void setModifiedon(FlexiDate value)
  {
    setAttributeInternal(MODIFIEDON, value);
  }



  /**
   * Ver si la posición permite realizar una salida
   * NOTA: No se mira el acceso a la ubicación
   * @return true si se puede reservar el contenido de la posición para una salida
   */
  public boolean isReservableSalida()
  {
    if (getEstado().equals("O"))
      return true;
    else
      return false;
  }


  public String toString ()
  {
    return "Cód. Ubi: " + getIdubi() + " posició: " + getPosicion() + " estat: " + getEstado();
  }

  /**
   * Liberar una posición
   * TODO - ver como controlar que no se libere una posición que tenga un MAC...
   */
  public void liberarPosicion()
  {
    setEstado ("L");
  }

  public void ocuparPosicion()
  {
    setEstado ("O");
  }

  public void reservarPosicion()
  {
    if (getEstado().equals("L"))
      setEstado ("R");
    else
    {
      LOG.error("intent de reservar la posició: " + toString());
      // Michael 13.01.2005 Provocar una excepción si el estado es diferente
      throw new JboException("se ha intentat reservar una posició en estat != Lliure: " + toString());
    }
    
  }

  public void quitarReservaPosicion()
  {
    if (getEstado().equals("R"))
      setEstado ("L");
    
  }


  public void setPendienteInspeccionPosicion()
  {
    setAcceso("I");
  }

  public void anularPendienteInspeccionPosicion()
  {
    setAcceso("L");
  }

  /**
   * 
   *  Gets the associated entity oracle.jbo.RowIterator
   */
  public RowIterator getSgamacDes()
  {
    return (RowIterator)getAttributeInternal(SGAMACDES);
  }


  /**
   * 
   *  Gets the associated entity oracle.jbo.RowIterator
   */
  public RowIterator getSgamacPos()
  {
    return (RowIterator)getAttributeInternal(SGAMACPOS);
  }



  public XMLNode getXMLPosicion(XMLNode node)
  {
  
    try 
    {
      XMLTelegrama.setValorNodo(node, "posUbicacion", getPosicion().toString());
      SgaubicacionImpl ubi = getSgaubicacion();
      return ubi.getXMLUbicacion(node);
    } catch (Exception ex) 
    {
      LOG.error("getXMLPosicion:", ex);
      // Michael TODO - parar o throw ?
    } 
    return node;
  }

  
  public XMLNode getXMLPosicionEntrada(XMLNode node)
  {
    // Si es la ubicación de entrada, no tiene posición
    SgaubicacionImpl ubi = getSgaubicacion();
    if (ubi instanceof SgaubicacionMiniLoadImpl)
    {
      // Si es el miniload, especifica el hueco
      XMLTelegrama.setValorNodo(node, "posUbicacion", getPosicion().toString());  
    }
    else
      XMLTelegrama.setValorNodo(node, "posUbicacion", "0");  
    return ubi.getXMLUbicacionEntrada(node);
  }
  
  public boolean isLibre ()
  {
    return getEstado ().equals("L");
  }

  /**
   * true si no tiene mac asociado a la posición (ubipos)
   * @return 
   */
  public boolean hasNoMac()
  {
    RowIterator macRows = getSgamacPos();
    macRows.reset();
    
    return !macRows.hasNext();
  }



  public void getDisponibilitatOcupada(Vector disponibilitat)
  {
      // L'estat ha de ser ocupat
      if (!(getEstado() != null && getEstado().equals("O")))
        disponibilitat.addElement(getEntityDef().getProperty("POSICIO_LLIURE"));
      // L'accés ha de ser lliure
      if (!(getAcceso() != null && getAcceso().equals("L")))
        disponibilitat.addElement(getEntityDef().getProperty("ACCES_BLOQUEJAT"));
  }
  
  public void getDisponibilitatLliure(Vector disponibilitat)
  {
    
  }

  /**
   * 
   *  Creates a Key object based on given key constituents
   */
  public static Key createPrimaryKey(Number posicion, String idubi)
  {
    return new Key(new Object[] {posicion, idubi});
  }
















}